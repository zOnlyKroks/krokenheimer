import { Client, Message, EmbedBuilder } from "discord.js";
import type { BotPlugin, BotCommand } from "../types/index.js";
import type { ExtensibleBot } from "../core/Bot.js";
import { Logger } from "../core/util/logger.js";

export class ASCIIArtPlugin implements BotPlugin {
    name = "ASCIIArtPlugin";
    description = "Generate ASCII art from text";
    version = "1.0.0";

    private logger = new Logger();

    commands: BotCommand[] = [
        {
            name: "ascii",
            description: "Generate ASCII art from text",
            execute: this.generateAsciiArt.bind(this)
        }
    ];

    // ASCII art fonts/styles
    private readonly fonts = {
        big: {
            'A': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â•šâ•â•  â•šâ•â•"
            ],
            'B': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â•šâ•â•â•â•â•â• "
            ],
            'C': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•”â•â•â•â•â•",
                "â–ˆâ–ˆâ•‘     ",
                "â–ˆâ–ˆâ•‘     ",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                " â•šâ•â•â•â•â•â•"
            ],
            'D': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â•šâ•â•â•â•â•â• "
            ],
            'E': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•”â•â•â•â•â•",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  ",
                "â–ˆâ–ˆâ•”â•â•â•  ",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â•â•â•"
            ],
            'F': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•”â•â•â•â•â•",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  ",
                "â–ˆâ–ˆâ•”â•â•â•  ",
                "â–ˆâ–ˆâ•‘     ",
                "â•šâ•â•     "
            ],
            'G': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â•â• ",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            'H': [
                "â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â•šâ•â•  â•šâ•â•"
            ],
            'I': [
                "â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘",
                "â•šâ•â•"
            ],
            'J': [
                "     â–ˆâ–ˆâ•—",
                "     â–ˆâ–ˆâ•‘",
                "     â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆ   â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â• "
            ],
            'K': [
                "â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• ",
                "â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—",
                "â•šâ•â•  â•šâ•â•"
            ],
            'L': [
                "â–ˆâ–ˆâ•—     ",
                "â–ˆâ–ˆâ•‘     ",
                "â–ˆâ–ˆâ•‘     ",
                "â–ˆâ–ˆâ•‘     ",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â•â•â•"
            ],
            'M': [
                "â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘",
                "â•šâ•â•     â•šâ•â•"
            ],
            'N': [
                "â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â•šâ•â•  â•šâ•â•â•â•"
            ],
            'O': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            'P': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â–ˆâ–ˆâ•”â•â•â•â• ",
                "â–ˆâ–ˆâ•‘     ",
                "â•šâ•â•     "
            ],
            'Q': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â–€â–€â•â• "
            ],
            'R': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â•šâ•â•  â•šâ•â•"
            ],
            'S': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•”â•â•â•â•â•",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â•šâ•â•â•â•â•â•â•"
            ],
            'T': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â–ˆâ–ˆâ•”â•â•â•",
                "   â–ˆâ–ˆâ•‘   ",
                "   â–ˆâ–ˆâ•‘   ",
                "   â–ˆâ–ˆâ•‘   ",
                "   â•šâ•â•   "
            ],
            'U': [
                "â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            'V': [
                "â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•",
                " â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• ",
                "  â•šâ•â•â•â•  "
            ],
            'W': [
                "â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•šâ•â•â• "
            ],
            'X': [
                "â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
                "â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•",
                " â•šâ–ˆâ–ˆâ–ˆâ•”â• ",
                " â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—",
                "â•šâ•â•  â•šâ•â•"
            ],
            'Y': [
                "â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—",
                "â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•",
                " â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• ",
                "  â•šâ–ˆâ–ˆâ•”â•  ",
                "   â–ˆâ–ˆâ•‘   ",
                "   â•šâ•â•   "
            ],
            'Z': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•",
                "  â–ˆâ–ˆâ–ˆâ•”â• ",
                " â–ˆâ–ˆâ–ˆâ•”â•  ",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â•â•â•"
            ],
            '0': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            '1': [
                " â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ•‘",
                "â•šâ–ˆâ–ˆâ•‘",
                " â–ˆâ–ˆâ•‘",
                " â–ˆâ–ˆâ•‘",
                " â•šâ•â•"
            ],
            '2': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•—",
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â–ˆâ–ˆâ•”â•â•â•â• ",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â•â•â•"
            ],
            '3': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•—",
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                "â•šâ•â•â•â•â•â• "
            ],
            '4': [
                "â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•‘",
                "     â–ˆâ–ˆâ•‘",
                "     â•šâ•â•"
            ],
            '5': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•”â•â•â•â•â•",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘",
                "â•šâ•â•â•â•â•â•â•"
            ],
            '6': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â•â• ",
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            '7': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•‘",
                "    â–ˆâ–ˆâ•”â•",
                "   â–ˆâ–ˆâ•”â• ",
                "  â–ˆâ–ˆâ•”â•  ",
                "  â•šâ•â•   "
            ],
            '8': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•",
                " â•šâ•â•â•â•â•â• "
            ],
            '9': [
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—",
                "â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ ",
                " â•šâ•â•â•â–ˆâ–ˆâ•‘ ",
                " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• ",
                " â•šâ•â•â•â•â•  "
            ],
            ' ': [
                "   ",
                "   ",
                "   ",
                "   ",
                "   ",
                "   "
            ],
            '!': [
                "â–ˆâ–ˆâ•—",
                "â–ˆâ–ˆâ•‘",
                "â–ˆâ–ˆâ•‘",
                "â•šâ•â•",
                "â–ˆâ–ˆâ•—",
                "â•šâ•â•"
            ],
            '?': [
                "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— ",
                "â•šâ•â•â•â•â–ˆâ–ˆâ•—",
                "  â–„â–ˆâ–ˆâ–ˆâ•”â•",
                "  â–€â–€â•â•â• ",
                "  â–ˆâ–ˆâ•—   ",
                "  â•šâ•â•   "
            ]
        }
    };

    async initialize(client: Client, bot: ExtensibleBot): Promise<void> {
        this.logger.info('ASCIIArtPlugin initialized');
    }

    async cleanup(): Promise<void> {
        this.logger.info('ASCIIArtPlugin cleanup completed');
    }

    private async generateAsciiArt(message: Message, args: string[]): Promise<void> {
        if (args.length === 0) {
            const helpEmbed = new EmbedBuilder()
                .setTitle("ğŸ¨ ASCII Art Generator")
                .setColor(0x0099ff)
                .setDescription("Convert text to ASCII art")
                .addFields([
                    {
                        name: "Usage",
                        value: "```\n" +
                               "!ascii <text>        - Generate ASCII art\n" +
                               "```",
                        inline: false
                    },
                    {
                        name: "Examples",
                        value: "```\n" +
                               "!ascii HELLO         - Creates ASCII art\n" +
                               "!ascii WELCOME       - Creates ASCII art\n" +
                               "!ascii 2024          - Creates ASCII art with numbers\n" +
                               "```",
                        inline: false
                    },
                    {
                        name: "Supported Characters",
                        value: "A-Z, 0-9, space, !, ?",
                        inline: false
                    }
                ])
                .setFooter({ text: "ASCII art will be displayed in a code block for best formatting" });

            await message.reply({ embeds: [helpEmbed] });
            return;
        }

        const text = args.join(' ');

        if (!text || text.trim().length === 0) {
            await message.reply("âŒ Please provide text to convert to ASCII art.");
            return;
        }

        // Limit text length
        if (text.length > 20) {
            await message.reply("âŒ Text too long! Please limit to 20 characters or less.");
            return;
        }

        try {
            const asciiArt = this.textToAscii(text.toUpperCase(), 'big');

            if (asciiArt.length > 2000) {
                await message.reply("âŒ Generated ASCII art is too long for Discord. Try shorter text.");
                return;
            }

            const embed = new EmbedBuilder()
                .setTitle("ğŸ¨ ASCII Art")
                .setColor(0x00ff00)
                .setDescription(`Text: **${text}**`)
                .addFields([
                    {
                        name: "Result",
                        value: "```\n" + asciiArt + "\n```",
                        inline: false
                    }
                ])
                .setTimestamp();

            await message.reply({ embeds: [embed] });

        } catch (error) {
            this.logger.error('ASCII art generation error:', error);
            await message.reply("âŒ Error generating ASCII art. Please try again with different text.");
        }
    }

    private textToAscii(text: string, fontName: 'big'): string {
        const font = this.fonts[fontName];
        const lines: string[] = [];

        // Get the height of the font (number of lines per character)
        const height = font['A'].length;

        // Initialize empty lines
        for (let i = 0; i < height; i++) {
            lines.push('');
        }

        // Build each line
        for (const char of text) {
            const asciiChar = font[char as keyof typeof font];

            if (asciiChar) {
                // Add each line of the character to the corresponding line
                for (let i = 0; i < height; i++) {
                    // @ts-ignore
                    lines[i] += asciiChar[i] + ' ';
                }
            } else {
                // Handle unsupported characters with spaces
                const spaceChar = font[' '];
                for (let i = 0; i < height; i++) {
                    // @ts-ignore
                    lines[i] += spaceChar[i] + ' ';
                }
            }
        }

        return lines.join('\n');
    }
}